"use strict";
/**
 * Description
 * @method exports
 * @param {} Promise
 * @param {} INTERNAL
 * @return 
 */
module.exports = function(Promise, INTERNAL) {
var PromiseReduce = Promise.reduce;
var PromiseAll = Promise.all;

/**
 * Description
 * @method promiseAllThis
 * @return CallExpression
 */
function promiseAllThis() {
    return PromiseAll(this);
}

/**
 * Description
 * @method PromiseMapSeries
 * @param {} promises
 * @param {} fn
 * @return CallExpression
 */
function PromiseMapSeries(promises, fn) {
    return PromiseReduce(promises, fn, INTERNAL, INTERNAL);
}

/**
 * Description
 * @method each
 * @param {} fn
 * @return CallExpression
 */
Promise.prototype.each = function (fn) {
    return this.mapSeries(fn)
            ._then(promiseAllThis, undefined, undefined, this, undefined);
};

/**
 * Description
 * @method mapSeries
 * @param {} fn
 * @return CallExpression
 */
Promise.prototype.mapSeries = function (fn) {
    return PromiseReduce(this, fn, INTERNAL, INTERNAL);
};

/**
 * Description
 * @method each
 * @param {} promises
 * @param {} fn
 * @return CallExpression
 */
Promise.each = function (promises, fn) {
    return PromiseMapSeries(promises, fn)
            ._then(promiseAllThis, undefined, undefined, promises, undefined);
};

Promise.mapSeries = PromiseMapSeries;
};
